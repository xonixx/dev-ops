@options timing

@goal init
@doc 'creates initial admin user'
  ansible-playbook --ask-pass -l web -i inventory.yml -e 'ansible_user=root' init.yml

@goal basic_config
@doc 'basic Linux configuration (hostname)'
  ansible-playbook -l web -i inventory.yml basic_config.yml

@goal users
@doc 'creates linux users'
  ansible-playbook -l web -i inventory.yml users.yml

@goal app_users
@doc 'creates application users'
  ansible-playbook -l web -i inventory.yml app_users.yml

@goal java
@doc 'installs Java'
  ansible-playbook -l web -i inventory.yml java.yml

@goal mongodb
@doc 'installs Mongodb'
  ansible-playbook -l web -i inventory.yml mongodb.yml

@goal docker
@doc 'installs Docker'
  ansible-playbook -l web -i inventory.yml docker.yml

@goal youtube-dl
@doc 'installs Youtube-DL'
  ansible-playbook -l web -i inventory.yml youtube-dl.yml

@goal youtube-dl-update
@doc 'updates Youtube-DL'
  ansible-playbook -l web -i inventory.yml youtube-dl.yml --extra-vars "youtubedl_update=true"

@goal yt-dlp
@doc 'installs Yt-dlp'
  ansible-playbook -l web -i inventory.yml youtube-dlp.yml

@goal yt-dlp-update
@doc 'updates Yt-dlp'
  ansible-playbook -l web -i inventory.yml youtube-dlp.yml --extra-vars "ytdlp_update=true"

@goal utils
@doc 'installs utils'
  ansible-playbook -l web -i inventory.yml utils.yml

@goal web-servers
@doc 'installs web servers'
  ansible-playbook -l web -i inventory.yml web-servers.yml

@goal web-certbot
@doc 'installs Certbot'
  ansible-playbook -l web -i inventory.yml web-certbot.yml

@goal nginx-configure
@doc 'configures Nginx'
  ansible-playbook -l web -i inventory.yml nginx-configure.yml

@goal haproxy-configure
@doc 'configures Haproxy'
  ansible-playbook -l web -i inventory.yml haproxy-configure.yml

@goal web
@depends_on web-servers
@depends_on web-certbot
@depends_on nginx-configure
@depends_on haproxy-configure
@depends_on certbot-setup-cron

@goal certbot-setup-cron
@doc 'sets up certbot to renew SSL cert regularly via cron'
  ansible-playbook -l web -i inventory.yml certbot-setup-cron.yml

@define SSH='ssh xonix@maximullaris.com'

@goal certbot-regenerate
@doc 'manually regenerates SSL cert with new domains'
@depends_on certbot-setup-cron
  $SSH "/opt/certbot-cron/certbot_regenerate_local.sh"

@goal ssh
@doc 'connects to server via SSH'
  $SSH

@goal all
@doc 'prepares Ubuntu 18.04 server'
#@depends_on init
@depends_on basic_config
@depends_on users
@depends_on app_users
@depends_on java
@depends_on mongodb
@depends_on docker
@depends_on youtube-dl
@depends_on yt-dlp
@depends_on utils
@depends_on web
